@model IEnumerable<AlphaFacev2.Models.Image>
@using Microsoft.AspNetCore.Http

@inject AlphaFacev2.Services.AccountServices  accountServices

@{
    ViewData["Title"] = "Index";
}

@{
    var user = accountServices.GetCurrentUser();
}

<div class="w3-padding-16"></div>

<div class="w3-content w3-container w3-padding-16" id="home">
    <h3 class="w3-center">Do a face comparison!</h3>
    <p class="w3-center"> Take a picture with your webcam and then press <em>Compare pictures</em>!</p>
</div>

<!-- First Grid: Logo & About -->
<div class="w3-padding-16 w3-center">
    <div class="w3-row">
        <div class="w3-half w3-black w3-container w3-center" style="height:500px">
            <div class="w3-padding-16">
                <h1>Profile picture</h1>
            </div>
            <div class="w3-padding-16">
                @{
                    var byteArray = user.ProfileImage;
                    var base64 = Convert.ToBase64String(byteArray);
                    var imgSrc = String.Format("data:image/jpg;base64,{0}", base64);
                }
                <img src="@imgSrc" style="height:240px;" alt="Profile picture">
            </div>
        </div>

        <div class="w3-half w3-black w3-container w3-opacity-min" style="height:500px">
            <div class="w3-padding-16 w3-center">
                <h1>Webcam picture</h1>
                <div class="w3-padding-16">
                    <div class="w3-center" style="height:240px;" alt="Webcam picture" id="results">
                        <section>
                            <div>
                                <div class="panel panel-default">
                                    <div class="panel-body">
                                        <div id="my_camera"></div>
                                        <!-- A button for taking snaps -->
                                        <div>
                                            <br />
                                            <form>
                                                <input type="button" class="btn btn-primary" value="Take Snapshot" onClick="take_snapshot()">
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">    </div>
                            <!-- First, include the Webcam.js JavaScript Library -->
                            <script src="~/webcamjs/webcam.js"></script>
                            <!-- Configure a few settings and attach camera -->
                            <script language="JavaScript">
                                Webcam.set({
                                    width: 320,
                                    height: 240,
                                    image_format: 'jpeg',
                                    jpeg_quality: 100
                                });
                                Webcam.attach('#my_camera');
                            </script>

                            <!-- Code to handle taking the snapshot and displaying it locally -->
                            <script language="JavaScript">
                                function take_snapshot() {
                                    // take snapshot and get image data
                                    Webcam.snap(function (data_uri) {
                                        // display results in page
                                        document.getElementById('results').innerHTML =
                                            '<img src="' + data_uri + '"/>';

                                        Webcam.upload(data_uri, '/Faces/Capture', function (code, text) {
                                                                                                                                        /*alert('Photo Captured')*/;
                                        });
                                    });
                                }
                            </script>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <form method="post" asp-controller="Faces" asp-action="CompareToWebcamPicture" style="text-align:left">
            <input type="submit" class="w3-centered w3-blue-grey w3-large w3-letter-spacing-small w3-animate-opacity w3-opacity-min w3-hover-opacity-off w3-btn" value="Click here to compare the pictures!" style="width:100%; height:80px; font-size:larger;">
        </form>
</div>